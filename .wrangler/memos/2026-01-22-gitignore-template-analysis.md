# .wrangler/.gitignore Template Analysis

**Date:** 2026-01-22
**Author:** Claude (Sonnet 4.5)
**Purpose:** Review and document the correct .gitignore template for .wrangler/ directories

## Executive Summary

The .wrangler/.gitignore template is dynamically generated by `hooks/session-start.sh` and is **mostly correct** but has issues:

1. **Issue Found**: `metrics/` is in gitignorePatterns but directory is not documented or used
2. **Issue Found**: Inconsistency in hooks-config.json location across documentation
3. **Working Correctly**: Template generation from workspace-schema.json
4. **Working Correctly**: Runtime directories (cache/, config/, logs/) properly ignored

## Current State Analysis

### What Should Be Tracked (gitTracked: true in schema)

These directories contain project governance and MUST be committed to git:

- `.wrangler/issues/` - Issue tracking files
- `.wrangler/issues/completed/` - Archived issues
- `.wrangler/specifications/` - Feature specifications
- `.wrangler/ideas/` - Ideas and proposals
- `.wrangler/memos/` - Reference material, RCAs
- `.wrangler/plans/` - Implementation plans
- `.wrangler/docs/` - Auto-generated documentation
- `.wrangler/templates/` - Issue/spec templates

### What Should NOT Be Tracked (gitTracked: false in schema)

These directories contain runtime data and MUST be gitignored:

- `.wrangler/cache/` - Runtime cache
- `.wrangler/config/` - Runtime configuration
- `.wrangler/logs/` - Runtime logs (e.g., messages.jsonl)
- `.wrangler/metrics/` - **QUESTIONABLE** (see issues below)

### Additional Patterns

The template also ignores:
- `../.wrangler-migration-backup-*/` - Temporary migration backups
- `SKIP_AUTO_MIGRATION` - Local migration marker
- `REMIND_NEXT_SESSION` - Local migration marker

## Template Generation Mechanism

The template is generated by `hooks/session-start.sh` (lines 92-104):

```bash
cat > "${GIT_ROOT}/.wrangler/.gitignore" <<GITIGNORE
# Wrangler gitignore - generated from workspace-schema.json

# Runtime data (don't commit)
${gitignore_patterns}

# Backup directories (temporary)
../.wrangler-migration-backup-*/

# Migration markers (local)
SKIP_AUTO_MIGRATION
REMIND_NEXT_SESSION
GITIGNORE
```

Where `gitignore_patterns` is extracted from `.wrangler/workspace-schema.json`:

```json
"gitignorePatterns": [
  "cache/",
  "config/",
  "logs/",
  "metrics/"
]
```

## Issues Identified

### Issue 1: metrics/ Directory - Undocumented and Unused

**Status:** NEEDS CLARIFICATION

**Evidence:**
- `metrics/` is in gitignorePatterns (workspace-schema.json:129)
- Directory is NOT defined in "directories" section of schema
- Directory does NOT exist in wrangler's own .wrangler/
- Only mentioned in SPEC-000001 (centralized directory spec)
- No metrics collection implementation found

**References:**
```bash
$ ls -la .wrangler/metrics/
ls: .wrangler/metrics/: No such file or directory

$ grep -r "metrics.*directory" .wrangler/
# No results
```

**Recommendation:** Remove `metrics/` from gitignorePatterns OR add proper documentation and directory definition if this is a planned feature.

### Issue 2: hooks-config.json Location Inconsistency

**Status:** DOCUMENTATION BUG

**Correct Location:** `.wrangler/hooks-config.json` (at root of .wrangler/)

**Incorrect References Found:**
- `skills/setup-git-hooks/SKILL.md` (5 occurrences)
  - Line 27: Says "config in `.wrangler/config/hooks-config.json`"
  - Line 51: Check command uses `.wrangler/config/hooks-config.json`
  - Line 130: Says creates `.wrangler/config/hooks-config.json`
  - Line 199: Description says "config in `.wrangler/config/hooks-config.json`"

**Correct References:**
- SPEC-000041-git-hooks-enforcement-framework-for-wrangler.md (17 occurrences)
- docs/git-hooks.md
- CLAUDE.md
- All other documentation

**Impact:**
- hooks-config.json should NOT be in .wrangler/config/ (which is gitignored)
- hooks-config.json SHOULD be in .wrangler/ root (tracked by git)
- The setup-git-hooks skill has incorrect paths in 5 places

**Recommendation:** Fix setup-git-hooks/SKILL.md to use `.wrangler/hooks-config.json`

### Issue 3: Git Hooks (Pattern B) Location

**Status:** CORRECT but needs clarification in .gitignore

**Pattern B Location:** `.wrangler/git-hooks/` (version-controlled hooks)

**Current State:**
- NOT in gitignorePatterns (correct - should be tracked)
- NOT in workspace-schema.json directories section (should it be?)
- Only created when Pattern B is chosen during setup

**Recommendation:** Consider adding to workspace-schema.json as optional directory:

```json
"git-hooks": {
  "path": ".wrangler/git-hooks",
  "description": "Version-controlled git hooks (Pattern B only)",
  "gitTracked": true,
  "optional": true
}
```

## Correct .gitignore Content (v1.2.0)

Based on workspace-schema.json and current implementation, the generated .gitignore should contain:

```gitignore
# Wrangler gitignore - generated from workspace-schema.json

# Runtime data (don't commit)
cache/
config/
logs/
metrics/

# Backup directories (temporary)
../.wrangler-migration-backup-*/

# Migration markers (local)
SKIP_AUTO_MIGRATION
REMIND_NEXT_SESSION
```

**Note:** If metrics/ is removed from schema, this becomes:

```gitignore
# Wrangler gitignore - generated from workspace-schema.json

# Runtime data (don't commit)
cache/
config/
logs/

# Backup directories (temporary)
../.wrangler-migration-backup-*/

# Migration markers (local)
SKIP_AUTO_MIGRATION
REMIND_NEXT_SESSION
```

## Root .gitignore vs .wrangler/.gitignore

### Project Root .gitignore

The wrangler project's root .gitignore correctly ignores the runtime .wrangler/ subdirectories:

```gitignore
# Wrangler runtime logs
.wrangler/logs/
```

This ensures that even if .wrangler/.gitignore is missing, logs won't be committed.

### .wrangler/.gitignore (Generated)

This is created inside .wrangler/ to ignore runtime directories relative to .wrangler/:
- `cache/` → `.wrangler/cache/`
- `config/` → `.wrangler/config/`
- `logs/` → `.wrangler/logs/`
- `metrics/` → `.wrangler/metrics/`

## Testing Verification

```bash
# Verify logs are properly ignored
$ git check-ignore -v .wrangler/logs/messages.jsonl
.gitignore:9:.wrangler/logs/    .wrangler/logs/messages.jsonl

# Verify issues are tracked
$ git status .wrangler/issues/
# Shows modified/untracked issues files

# Verify .wrangler/.gitignore doesn't exist in wrangler's own repo
$ ls .wrangler/.gitignore
ls: .wrangler/.gitignore: No such file or directory
```

**Finding:** Wrangler's own repository doesn't have a .wrangler/.gitignore because it uses the root .gitignore to handle these patterns. The generated .gitignore is for user projects.

## Recommendations Summary

### High Priority

1. **Fix setup-git-hooks/SKILL.md** - Update 5 references from `.wrangler/config/hooks-config.json` to `.wrangler/hooks-config.json`

### Medium Priority

2. **Clarify metrics/ status** - Either:
   - Remove from gitignorePatterns if not used
   - Add to directories section if planned feature
   - Document why it exists if placeholder

3. **Document git-hooks/ location** - Add optional directory to workspace-schema.json for Pattern B

### Low Priority

4. **Add validation** - Create test to verify gitignorePatterns match actual directory usage

## Files Reviewed

- `/Users/sam/medb/projects/wrangler/.gitignore` - Root gitignore
- `/Users/sam/medb/projects/wrangler/hooks/session-start.sh` - Template generator
- `/Users/sam/medb/projects/wrangler/.wrangler/workspace-schema.json` - Schema definition
- `/Users/sam/medb/projects/wrangler/skills/setup-git-hooks/SKILL.md` - Git hooks skill
- `/Users/sam/medb/projects/wrangler/docs/git-hooks.md` - Git hooks documentation
- `/Users/sam/medb/projects/wrangler/CLAUDE.md` - Project documentation
- `.wrangler/specifications/SPEC-000041-git-hooks-enforcement-framework-for-wrangler.md` - Git hooks spec

## Conclusion

The .gitignore template generation mechanism is **working correctly** with the following caveats:

1. Documentation bug in setup-git-hooks/SKILL.md (wrong path for hooks-config.json)
2. Questionable metrics/ directory in gitignorePatterns
3. Template correctly ignores runtime directories (cache/, config/, logs/)
4. Template correctly tracks governance directories (issues/, specs/, memos/, plans/, docs/)

**No changes to the template itself are needed**, but documentation fixes are recommended.
